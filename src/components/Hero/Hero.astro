---
import { Image } from 'astro:assets';
import styles from './Hero.module.css';
import type { HeroProps, BannerImagePaths } from './Hero.types';
import { getTranslation } from '../../i18n/useTranslation';
import { bannerImages } from './images';

const { title, subtitle, buttonText, lang } = Astro.props as HeroProps;
const t = await getTranslation(lang);

// Убеждаемся, что пути к изображениям соответствуют типу
const slides = t.hero.slides.map(slide => ({
  ...slide,
  src: slide.src as BannerImagePaths
}));
---

<section class={styles.heroSlider}>
  {slides.map((slide, index) => (
    <div class={styles.slide} data-active={index === 0}>
      <Image 
        src={bannerImages[slide.src]}
        width={960}
        height={480}
        loading={index === 0 ? "eager" : "lazy"}
        fetchpriority={index === 0 ? "high" : "auto"}
        alt={slide.alt}
        class={styles.backgroundSlide}
        format="webp"
        quality={80}
      />
    </div>
  ))}
  
  <div class={styles.overlay}>
    <div class={styles.container}>
      <h1>{title}</h1>
      <h2>{subtitle}</h2>
      <button id="heroOrderButton" type="button">{buttonText}</button>
    </div>
  </div>
</section>

<script>
  function setupSlider() {
    const slides = document.querySelectorAll('[data-active]');
    let currentSlide = 0;
    
    function nextSlide() {
      slides[currentSlide].setAttribute('data-active', 'false');
      currentSlide = (currentSlide + 1) % slides.length;
      slides[currentSlide].setAttribute('data-active', 'true');
    }
    
    setInterval(nextSlide, 5000);
  }

  document.addEventListener('DOMContentLoaded', () => {
    setupSlider();
    
    const heroOrderButton = document.getElementById('heroOrderButton');
    const openOrderModal = (window as any).openOrderModal;
    
    if (heroOrderButton && typeof openOrderModal === 'function') {
      heroOrderButton.addEventListener('click', openOrderModal);
    }
  });
</script>
